# Market Scanner

Python-приложение для анализа рынка акций США и выявления трех типов рыночных ситуаций:
- **Сильный тренд** (Strong Trend)
- **Паника** (Panic)
- **Эйфория** (Euphoria)

## Структура проекта

```
market_scanner/
├── main.py                 # Точка входа (топ-100 акций)
├── main_full.py            # Полный сканер (5000+ акций)
├── prepare_universe.py     # Подготовка списка всех акций
├── data_loader.py          # Загрузка данных из Yahoo Finance
├── universe_loader.py      # Загрузка полного универсума акций
├── strategies.py           # Логика стратегий
├── filters.py              # Фильтрация универсума
├── config.py               # Конфигурация
├── requirements.txt        # Зависимости
├── data/                   # Папка для кэша данных
└── results/                # Папка для результатов
```

## Установка

1. Установите зависимости:
```bash
pip3 install -r requirements.txt
```

2. Убедитесь, что установлены следующие библиотеки:
- yfinance >= 0.2.33
- pandas >= 2.0.0
- pytz >= 2023.3

## Использование

### Режим 1: Топ-100 акций (быстрый)

Для анализа топ-100 акций по капитализации (~5 минут):
```bash
python3 main.py
```

### Режим 2: Полный универсум 5000+ акций

**Шаг 1: Подготовка списка акций** (один раз, ~1 минута):
```bash
python3 prepare_universe.py
```

Это создаст файл `data/us_stock_universe.txt` со всеми акциями с бирж NASDAQ, NYSE, AMEX.

**Шаг 2: Запуск полного сканирования**:
```bash
python3 main_full.py
```

⚠️ **Внимание**: Полное сканирование занимает значительное время:
- ~5000 акций × 0.5 сек задержка = **~40 минут** только на загрузку данных
- Плюс время на обработку

**Рекомендация**: Запускайте в фоне или используйте экранную сессию:
```bash
# Запуск в фоне с сохранением лога
nohup python3 main_full.py > scan.log 2>&1 &

# Или используйте screen/tmux для долгих сессий
screen -S scanner
python3 main_full.py
# Отсоединиться: Ctrl+A, D
# Присоединиться: screen -r scanner
```

### Workflow программы:
1. Загрузит список тикеров (из кэша или с бирж)
2. Получит исторические данные за 30 дней
3. Применит фильтры (капитализация ≥$500M, цена ≥$3, объем ≥$20M)
4. Классифицирует акции по стратегиям
5. Выведет результаты на экран
6. Сохранит результаты в JSON файл

## Расширение до 5000+ акций

Для анализа полного рынка США см. подробное руководство: **[FULL_UNIVERSE_GUIDE.md](FULL_UNIVERSE_GUIDE.md)**

**Краткая инструкция**:

1. **Получите список всех акций**:
   ```bash
   # Вариант A: Кураторский список (394 акции)
   python3 create_universe_manual.py

   # Вариант B: Импорт из FinViz (5000+ акций)
   # Скачайте CSV с finviz.com, затем:
   python3 import_from_csv.py data/finviz_export.csv
   ```

2. **Запустите полное сканирование**:
   ```bash
   python3 main_full.py
   ```

⚠️ Для 5000 акций потребуется ~40-50 минут

## Конфигурация

Настройте параметры в файле [config.py](config.py):

### Фильтры универсума
- `MIN_MARKET_CAP`: минимальная капитализация ($500M)
- `MIN_PRICE`: минимальная цена акции ($3)
- `MIN_AVG_VOLUME`: минимальный средний объем ($20M)
- `TOP_N_STOCKS`: количество акций для анализа (100)

### Пороги стратегий

**Сильный тренд:**
- `STRONG_TREND_MIN_GAIN`: 5% роста за каждый из 3 дней подряд
- `STRONG_TREND_3DAY_TOTAL`: или 15% суммарного роста за 3 дня

**Паника:**
- `PANIC_1DAY_DROP`: падение 8% за день
- `PANIC_3DAY_DROP`: падение 15% за 3 дня
- `PANIC_VOLUME_MULTIPLIER`: объем > 1.5× среднего

**Эйфория:**
- `EUPHORIA_1DAY_GAIN`: рост 8% за день
- `EUPHORIA_5DAY_GAIN`: рост 20% за 5 дней

## Выходные данные

### Консольный вывод
```
=== СИЛЬНЫЙ ТРЕНД (5 акций) ===
AAPL   | $182.50 | +6.2% (1d) | +18.5% (3d) | Причина: 3 дня роста подряд

=== ПАНИКА (3 акции) ===
TSLA   | $245.30 | -9.8% (1d) | -12.1% (3d) | Причина: Падение >8% за день

=== ЭЙФОРИЯ (2 акции) ===
NVDA   | $520.80 | +11.2% (1d) | +25.3% (5d) | Причина: Рост >20% за 5 дней
```

### Файлы результатов

**results/scan_YYYYMMDD_HHMMSS.json** - результаты сканирования:
```json
{
  "timestamp": "20260114_142455",
  "analysis_date": "2026-01-14T14:24:55-05:00",
  "config": {...},
  "results": {
    "strong_trend": [...],
    "panic": [...],
    "euphoria": [...]
  },
  "summary": {
    "strong_trend_count": 5,
    "panic_count": 3,
    "euphoria_count": 2,
    "total_classified": 10
  }
}
```

**data/cache_YYYYMMDD_HHMMSS.json** - кэш загруженных данных

## Тестирование

Для тестирования с 10 акциями измените в [config.py](config.py):
```python
TOP_N_STOCKS = 10
```

Для отладки используйте вспомогательные скрипты:
- `test_debug.py` - просмотр изменений цен
- `test_strategies.py` - тестирование стратегий с пониженными порогами

## Логика классификации

### Приоритет стратегий
1. Сильный тренд (сначала проверяется)
2. Паника
3. Эйфория

Если акция подходит одновременно под Панику И Эйфорию - исключается (шум).

### Детали стратегий

**Сильный тренд:**
- 3 дня подряд роста ≥5% каждый день
- ИЛИ суммарный рост ≥15% за 3 дня с положительной динамикой

**Паника:**
- Падение ≥8% за день (с проверкой объема)
- ИЛИ падение ≥15% за 3 дня

**Эйфория:**
- Рост ≥8% за день
- ИЛИ рост ≥20% за 5 дней
- С проверкой ускорения (последний день > средний)

## Обработка ошибок

- Автоматический retry при ошибках загрузки
- Пропуск недоступных тикеров
- Задержка 0.5 сек между запросами (защита от блокировки)
- Fallback на предопределенный список при недоступности Wikipedia

## Технические детали

- Python 3.10+
- Данные: Yahoo Finance API (через yfinance)
- Временная зона: America/New_York (NYSE)
- История: 30 дней (для учета праздников)
- Средний объем: рассчитывается за 20 дней
